Ext.namespace("MODx.util.Progress");MODx.util.JSONReader=function(A){A=A||{};Ext.applyIf(A,{successProperty:"success",totalProperty:"total",root:"data"});MODx.util.JSONReader.superclass.constructor.call(this,A,["id","msg"]);};Ext.extend(MODx.util.JSONReader,Ext.data.JsonReader);Ext.reg("modx-json-reader",MODx.util.JSONReader);MODx.util.Progress={id:0,time:function(A,C,B){B=B||_("saving");if(MODx.util.Progress.id===C&&A<11){Ext.MessageBox.updateProgress(A/10,B);}},reset:function(){MODx.util.Progress.id=MODx.util.Progress.id+1;}};MODx.LockMask=function(A){A=A||{};Ext.applyIf(A,{msg:_("locked"),msgCls:"modx-lockmask"});MODx.LockMask.superclass.constructor.call(this,A.el,A);};Ext.extend(MODx.LockMask,Ext.LoadMask,{locked:false,toggle:function(){if(this.locked){this.hide();this.locked=false;}else{this.show();this.locked=true;}},lock:function(){this.locked=true;this.show();},unlock:function(){this.locked=false;this.hide();}});Ext.reg("modx-lockmask",MODx.LockMask);Ext.override(Ext.form.BasicForm,{clearDirty:function(A){A=A||this;A.items.each(function(B){if(B.items){this.clearDirty(B);}else{if(B.originalValue!=B.getValue()){B.originalValue=B.getValue();}}},this);}});MODx.StaticTextField=Ext.extend(Ext.form.TextField,{fieldClass:"x-static-text-field",onRender:function(){this.readOnly=true;this.disabled=!this.initialConfig.submitValue;MODx.StaticTextField.superclass.onRender.apply(this,arguments);}});Ext.reg("statictextfield",MODx.StaticTextField);MODx.StaticBoolean=Ext.extend(Ext.form.TextField,{fieldClass:"x-static-text-field",onRender:function(A){this.readOnly=true;this.disabled=!this.initialConfig.submitValue;MODx.StaticBoolean.superclass.onRender.apply(this,arguments);this.on("change",this.onChange,this);},setValue:function(A){if(A===1){this.addClass("green");A=_("yes");}else{this.addClass("red");A=_("no");}MODx.StaticBoolean.superclass.setValue.apply(this,arguments);}});Ext.reg("staticboolean",MODx.StaticBoolean);Ext.override(Ext.form.Checkbox,{setBoxLabel:function(A){this.boxLabel=A;if(this.rendered){this.wrap.child(".x-form-cb-label").update(A);}}});Array.prototype.in_array=function(A){for(var C=0,B=this.length;C<B;C=C+1){if(this[C]===A){return true;}}return false;};Ext.form.setCheckboxValues=function(B,E,A){var C,D=0;while((C=B.findField(E+D))!==null){C.setValue((A&(1<<D))?"true":"false");D=D+1;}};Ext.form.getCheckboxMask=function(D){var B="";if(typeof (D)!=="undefined"){if((typeof (D)==="string")){B=D+"";}else{for(var C=0,A=D.length;C<A;C=C+1){B+=(B!==""?",":"")+(D[C]-0);}}}return B;};Ext.form.BasicForm.prototype.append=function(){var C=new Ext.form.Layout();var A=[];C.stack.push.apply(C.stack,arguments);for(var B=0;B<arguments.length;B=B+1){if(arguments[B].isFormField){A.push(arguments[B]);}}C.render(this.el);if(A.length>0){this.items.addAll(A);for(var D=0;D<A.length;D=D+1){A[D].render("x-form-el-"+A[D].id);}}return this;};Ext.form.AMPMField=function(B,A){return new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["ampm"],data:[["am"],["pm"]]}),displayField:"ampm",hiddenName:B,mode:"local",editable:false,forceSelection:true,triggerAction:"all",width:60,value:A||"am"});};Ext.form.HourField=function(C,B,A){return new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["hour"],data:[[1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11],[12]]}),displayField:"hour",mode:"local",triggerAction:"all",width:60,forceSelection:true,rowHeight:false,editable:false,value:A||1,transform:C});};Ext.override(Ext.tree.TreeNodeUI,{hasClass:function(B){var A=Ext.fly(this.elNode);if(!A){return"";}return B&&(" "+A.dom.className+" ").indexOf(" "+B+" ")!==-1;}});Ext.override(Ext.form.Action.Submit,{handleResponse:function(D){var B=Ext.decode(D.responseText);if(this.form.errorReader){var C=this.form.errorReader.read(D);var G=[];if(C.records){for(var E=0,A=C.records.length;E<A;E=E+1){var F=C.records[E];G[E]=F.data;}}if(G.length<1){G=null;}return{success:C.success,message:B.message,object:B.object,errors:G};}return Ext.decode(D.responseText);}});Ext.form.Field.prototype.afterRender=Ext.form.Field.prototype.afterRender.createSequence(function(){if(this.description){Ext.QuickTips.register({target:this.getEl(),text:this.description,enabled:true});var A=Ext.form.Field.findLabel(this);if(A){Ext.QuickTips.register({target:A,text:this.description,enabled:true});}}});Ext.applyIf(Ext.form.Field,{findLabel:function(C){var B=null;var A=null;B=C.getEl().up("div.x-form-element");if(B){A=B.child("label");}if(A){return A;}B=C.getEl().up("div.x-form-item");if(B){A=B.child("label");}if(A){return A;}}});MODx.util.Clipboard=function(){return{escape:function(A){A=encodeURIComponent(A);return A.replace(/%0A/g,"%0D%0A");},copy:function(C){if(Ext.isIE){window.clipboardData.setData("Text",C);}else{var B="flashcopier";if(!document.getElementById(B)){var D=document.createElement("div");D.id=B;document.body.appendChild(D);}document.getElementById(B).innerHTML="";var A='<embed src="'+MODx.config.manager_url+'assets/modext/_clipboard.swf" FlashVars="clipboard='+MODx.util.Clipboard.escape(C)+'" width="0" height="0" type="application/x-shockwave-flash"></embed>';document.getElementById(B).innerHTML=A;}}};}();Ext.util.Format.trimCommas=function(B){B=B.replace(",,",",");var A=B.length;if(B.substr(A-1,1)==","){B=B.substring(0,A-1);}if(B.substr(0,1)==","){B=B.substring(1);}if(B==","){B="";}return B;};Ext.ns("Ext.ux.grid");if("function"!==typeof RegExp.escape){RegExp.escape=function(A){if("string"!==typeof A){return A;}return A.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1");};}Ext.ux.grid.RowActions=function(A){Ext.apply(this,A);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this);};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,dataIndex:"",editable:false,header:"",isColumn:true,keepSelection:false,menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions"><div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> {cls}" style="{style}" qtip="{qtip}">{text}</div></tpl>',tplRow:'<div class="ux-row-action"><tpl for="actions"><div class="ux-row-action-item {cls} <tpl if="text">ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}"><tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div></tpl></div>',hideMode:"visibility",widthIntercept:4,widthSlope:21,init:function(D){this.grid=D;this.id=this.id||Ext.id();var C=D.getColumnModel().lookup;delete (C[undefined]);C[this.id]=this;if(!this.tpl){this.tpl=this.processActions(this.actions);}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true;}var B=D.getView();var A={scope:this};A[this.actionEvent]=this.onClick;D.afterRender=D.afterRender.createSequence(function(){B.mainBody.on(A);D.on("destroy",this.purgeListeners,this);},this);if(!this.renderer){this.renderer=function(F,E,J,I,H,G){E.css+=(E.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(F,E,J,I,H,G));}.createDelegate(this);}if(B.groupTextTpl&&this.groupActions){B.interceptMouse=B.interceptMouse.createInterceptor(function(E){if(E.getTarget(".ux-grow-action-item")){return false;}});B.groupTextTpl='<div class="ux-grow-action-text">'+B.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply();}if(true===this.keepSelection){D.processEvent=D.processEvent.createInterceptor(function(E,F){if("mousedown"===E){return !this.getAction(F);}},this);}},getData:function(B,A,F,E,D,C){return F.data||{};},processActions:function(A,D){var C=[];Ext.each(A,function(E,F){if(E.iconCls&&"function"===typeof (E.callback||E.cb)){this.callbacks=this.callbacks||{};this.callbacks[E.iconCls]=E.callback||E.cb;}var G={cls:E.iconIndex?"{"+E.iconIndex+"}":(E.iconCls?E.iconCls:""),qtip:E.qtipIndex?"{"+E.qtipIndex+"}":(E.tooltip||E.qtip?E.tooltip||E.qtip:""),text:E.textIndex?"{"+E.textIndex+"}":(E.text?E.text:""),hide:E.hideIndex?'<tpl if="'+E.hideIndex+'">'+("display"===this.hideMode?"display:none":"visibility:hidden")+";</tpl>":(E.hide?("display"===this.hideMode?"display:none":"visibility:hidden;"):""),align:E.align||"right",style:E.style?E.style:""};C.push(G);},this);var B=new Ext.XTemplate(D||this.tplRow);return new Ext.XTemplate(B.apply({actions:C}));},getAction:function(C){var A=false;var B=C.getTarget(".ux-row-action-item");if(B){A=B.className.replace(/ux-row-action-item /,"");if(A){A=A.replace(/ ux-row-action-text/,"");A=A.trim();}}return A;},onClick:function(G,K){var J=this.grid.getView();var I=G.getTarget(".x-grid3-row");var H=J.findCellIndex(K.parentNode.parentNode);var F=this.getAction(G);if(false!==I&&false!==H&&false!==F){var E=this.grid.store.getAt(I.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[F]){this.callbacks[F](this.grid,E,F,I.rowIndex,H);}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,E,F,I.rowIndex,H)){return ;}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,E,F,I.rowIndex,H);}}}t=G.getTarget(".ux-grow-action-item");if(t){var D=J.findGroup(K);var C=D?D.id.replace(/ext-gen[0-9]+-gp-/,""):null;var B;if(C){var A=new RegExp(RegExp.escape(C));B=this.grid.store.queryBy(function(L){return L._groupId.match(A);});B=B?B.items:[];}F=t.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[F]){this.callbacks[F](this.grid,B,F,C);}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,B,F,C)){return false;}this.fireEvent("groupaction",this.grid,B,F,C);}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);Ext.SwitchButton=Ext.extend(Ext.Component,{initComponent:function(){Ext.SwitchButton.superclass.initComponent.call(this);var A=new Ext.util.MixedCollection();A.addAll(this.items);this.items=A;this.addEvents("change");if(this.handler){this.on("change",this.handler,this.scope||this);}},onRender:function(K,J){var I=document.createElement("table");I.cellSpacing=0;I.className="x-rbtn";I.id=this.id;var H=document.createElement("tr");I.appendChild(H);var G=this.items.length;var F=G-1;this.activeItem=this.items.get(this.activeItem);for(var C=0;C<G;C++){var E=this.items.itemAt(C);var D=H.appendChild(document.createElement("td"));D.id=this.id+"-rbi-"+C;var B=C===0?"x-rbtn-first":(C==F?"x-rbtn-last":"x-rbtn-item");E.baseCls=B;if(this.activeItem==E){B+="-active";}D.className=B;var A=document.createElement("button");A.innerHTML="&#160;";A.className=E.iconCls;A.title=E.tooltip;D.appendChild(A);E.cell=D;}this.el=Ext.get(K.dom.appendChild(I));this.el.on("click",this.onClick,this);},getActiveItem:function(){return this.activeItem;},setActiveItem:function(B){if(typeof B!="object"&&B!==null){B=this.items.get(B);}var A=this.getActiveItem();if(B!=A){if(A){Ext.fly(A.cell).removeClass(A.baseCls+"-active");}if(B){Ext.fly(B.cell).addClass(B.baseCls+"-active");}this.activeItem=B;this.fireEvent("change",this,B);}return B;},onClick:function(B){var A=B.getTarget("td",2);if(!this.disabled&&A){this.setActiveItem(parseInt(A.id.split("-rbi-")[1],10));}}});Ext.reg("switch",Ext.SwitchButton);Ext.onReady(function(){MODx.util.JSONReader=MODx.load({xtype:"modx-json-reader"});MODx.form.Handler=MODx.load({xtype:"modx-form-handler"});MODx.msg=MODx.load({xtype:"modx-msg"});});